<UserControl x:Class="KawaiiStudio.App.Views.TemplateEditorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="#F6F2EA">
  <Grid>
    <Image Source="{Binding BackgroundPath, Converter={StaticResource FilePathToImage}}"
           Stretch="UniformToFill"
           Opacity="0.9" />
    <Rectangle Fill="#CCF6F2EA" />
    <Grid Margin="24">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="*" />
      </Grid.RowDefinitions>

      <DockPanel Grid.Row="0" LastChildFill="False" Margin="0,0,0,16">
        <Button Content="Back" Command="{Binding BackCommand}" />
        <TextBlock Text="Template Editor" FontSize="28" FontWeight="SemiBold" Margin="16,0,0,0" />
      </DockPanel>

      <Grid Grid.Row="1">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="320" />
        </Grid.ColumnDefinitions>

        <Border Background="#EEE7DD" CornerRadius="12" Padding="12" Margin="0,0,16,0">
          <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
            <Grid Width="{Binding TemplateWidth}" Height="{Binding TemplateHeight}">
              <Rectangle Fill="#E2D9CF" />

              <ItemsControl ItemsSource="{Binding Slots}">
                <ItemsControl.ItemsPanel>
                  <ItemsPanelTemplate>
                    <Canvas />
                  </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemContainerStyle>
                  <Style TargetType="ContentPresenter">
                    <Setter Property="Canvas.Left" Value="{Binding X}" />
                    <Setter Property="Canvas.Top" Value="{Binding Y}" />
                  </Style>
                </ItemsControl.ItemContainerStyle>
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <Grid Width="{Binding Width}" Height="{Binding Height}">
                      <Border Background="#33198F4A" BorderBrush="#66FFFFFF" BorderThickness="2" CornerRadius="6" />
                      <TextBlock Text="{Binding Label}" FontSize="12" Foreground="#F2F2F2" Margin="6" />
                      <Thumb DragDelta="OnSlotDragDelta" Cursor="SizeAll" Background="Transparent" />
                      <Thumb Width="14"
                             Height="14"
                             HorizontalAlignment="Right"
                             VerticalAlignment="Bottom"
                             DragDelta="OnSlotResizeDragDelta"
                             Cursor="SizeNWSE"
                             Background="#F2F2F2"
                             Margin="0,0,2,2" />
                    </Grid>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>

              <Image Source="{Binding FramePreviewPath, Converter={StaticResource FilePathToImage}}"
                     Stretch="Fill"
                     Panel.ZIndex="2"
                     IsHitTestVisible="False" />

              <ItemsControl ItemsSource="{Binding QrSlots}" Panel.ZIndex="3">
                <ItemsControl.ItemsPanel>
                  <ItemsPanelTemplate>
                    <Canvas />
                  </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemContainerStyle>
                  <Style TargetType="ContentPresenter">
                    <Setter Property="Canvas.Left" Value="{Binding X}" />
                    <Setter Property="Canvas.Top" Value="{Binding Y}" />
                  </Style>
                </ItemsControl.ItemContainerStyle>
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <Grid Width="{Binding Width}" Height="{Binding Height}">
                      <Border Background="#33D17A22" BorderBrush="#FFEBB345" BorderThickness="2" CornerRadius="6" />
                      <TextBlock Text="QR" FontSize="12" Foreground="#F2F2F2" Margin="6" />
                      <Thumb DragDelta="OnQrDragDelta" Cursor="SizeAll" Background="Transparent" />
                      <Thumb Width="14"
                             Height="14"
                             HorizontalAlignment="Right"
                             VerticalAlignment="Bottom"
                             DragDelta="OnQrResizeDragDelta"
                             Cursor="SizeNWSE"
                             Background="#F2F2F2"
                             Margin="0,0,2,2" />
                    </Grid>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </Grid>
          </ScrollViewer>
        </Border>

        <StackPanel Grid.Column="1">
          <TextBlock Text="Template" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,8" />
          <ComboBox ItemsSource="{Binding TemplateTypes}"
                    SelectedItem="{Binding SelectedTemplateType}"
                    Margin="0,0,0,8" />
          <TextBlock Text="{Binding TemplateWidth, StringFormat=Width: {0}}" FontSize="12" Foreground="#B8B8B8" />
          <TextBlock Text="{Binding TemplateHeight, StringFormat=Height: {0}}" FontSize="12" Foreground="#B8B8B8" Margin="0,0,0,8" />

          <TextBlock Text="Frame preview" FontSize="12" Foreground="#B8B8B8" Margin="0,0,0,4" />
          <ComboBox ItemsSource="{Binding Frames}"
                    SelectedItem="{Binding SelectedFrame}"
                    DisplayMemberPath="Name"
                    Margin="0,0,0,12" />

          <TextBlock Text="Slots" FontSize="12" Foreground="#B8B8B8" Margin="0,0,0,4" />
          <ScrollViewer VerticalScrollBarVisibility="Auto" Height="220">
            <ItemsControl ItemsSource="{Binding Slots}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding Label}" FontSize="12" Foreground="#F2F2F2" />
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </ScrollViewer>

          <TextBlock Text="{Binding StatusText}" FontSize="12" Foreground="#B8B8B8" Margin="0,12,0,12" />
          <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="Reset" Command="{Binding ResetCommand}" Padding="16,8" />
            <Button Content="Save" Command="{Binding SaveCommand}" Padding="16,8" Margin="8,0,0,0" />
          </StackPanel>
          <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
            <Button Content="Save Frame Override" Command="{Binding SaveFrameOverrideCommand}" Padding="16,8" />
            <Button Content="Clear Override" Command="{Binding ClearFrameOverrideCommand}" Padding="16,8" Margin="8,0,0,0" />
          </StackPanel>
        </StackPanel>
      </Grid>
    </Grid>
  </Grid>
</UserControl>


