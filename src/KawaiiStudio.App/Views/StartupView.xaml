<UserControl x:Class="KawaiiStudio.App.Views.StartupView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:KawaiiStudio.App.ViewModels">
  <UserControl.Style>
    <Style TargetType="UserControl">
      <Setter Property="Background" Value="#F6F2EA" />
      <Style.Triggers>
        <DataTrigger Binding="{Binding IsTestMode}" Value="True">
          <Setter Property="Background" Value="#3B82F6" />
        </DataTrigger>
      </Style.Triggers>
    </Style>
  </UserControl.Style>
  <UserControl.Resources>
    <Style x:Key="StartupTileBorderStyle" TargetType="Border">
      <Setter Property="Background" Value="#EEE7DD" />
      <Setter Property="BorderThickness" Value="4" />
      <Setter Property="CornerRadius" Value="12" />
      <Setter Property="Padding" Value="16" />
      <Setter Property="Width" Value="200" />
      <Setter Property="Height" Value="200" />
      <Setter Property="Margin" Value="0,0,16,16" />
      <Setter Property="BorderBrush" Value="#FACC15" />
      <Style.Triggers>
        <DataTrigger Binding="{Binding State}" Value="{x:Static vm:StartupCheckState.Pending}">
          <Setter Property="BorderBrush" Value="#FACC15" />
        </DataTrigger>
        <DataTrigger Binding="{Binding State}" Value="{x:Static vm:StartupCheckState.Testing}">
          <Setter Property="BorderBrush" Value="#F97316" />
        </DataTrigger>
        <DataTrigger Binding="{Binding State}" Value="{x:Static vm:StartupCheckState.Success}">
          <Setter Property="BorderBrush" Value="#22C55E" />
        </DataTrigger>
        <DataTrigger Binding="{Binding State}" Value="{x:Static vm:StartupCheckState.Error}">
          <Setter Property="BorderBrush" Value="#EF4444" />
        </DataTrigger>
      </Style.Triggers>
    </Style>
  </UserControl.Resources>
  <Grid>
    <Image Source="{Binding BackgroundPath, Converter={StaticResource FilePathToImage}}"
           Stretch="UniformToFill"
           Opacity="0.9" />
    <Rectangle>
      <Rectangle.Style>
        <Style TargetType="Rectangle">
          <Setter Property="Fill" Value="#CCF6F2EA" />
          <Style.Triggers>
            <DataTrigger Binding="{Binding IsTestMode}" Value="True">
              <Setter Property="Fill" Value="#CC3B82F6" />
            </DataTrigger>
          </Style.Triggers>
        </Style>
      </Rectangle.Style>
    </Rectangle>
    <Grid Margin="24">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="*" />
        <RowDefinition Height="Auto" />
      </Grid.RowDefinitions>

      <StackPanel Grid.Row="0" Margin="0,0,0,16">
        <TextBlock Text="Startup Checks" FontSize="28" FontWeight="SemiBold" />
        <TextBlock Text="{Binding ModeText}" FontSize="12" Foreground="#B8B8B8" />
      </StackPanel>

      <ScrollViewer Grid.Row="1"
                    VerticalScrollBarVisibility="Auto"
                    HorizontalScrollBarVisibility="Disabled">
        <ItemsControl ItemsSource="{Binding Checks}">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <WrapPanel />
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <Border Style="{StaticResource StartupTileBorderStyle}">
                <StackPanel VerticalAlignment="Center">
                  <TextBlock Text="{Binding Name}" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,8" />
                  <TextBlock Text="{Binding Status}" FontSize="14" Margin="0,0,0,6" />
                  <TextBlock Text="{Binding Detail}"
                             FontSize="12"
                             Foreground="#8A8A8A"
                             TextWrapping="Wrap" />
                </StackPanel>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </ScrollViewer>

      <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
        <Button Content="Enable Test Mode" Command="{Binding EnableTestModeCommand}" Padding="16,8" />
        <Button Content="Retry" Command="{Binding RetryCommand}" Padding="16,8" Margin="8,0,0,0" />
        <Button Content="Errors found - Continue anyways"
                Command="{Binding ForceContinueCommand}"
                Padding="16,8"
                Margin="8,0,0,0"
                Visibility="{Binding CanForceContinue, Converter={StaticResource BoolToVisibility}}" />
        <Button Content="Continue" Command="{Binding ContinueCommand}" Padding="16,8" Margin="8,0,0,0" />
      </StackPanel>
    </Grid>
  </Grid>
</UserControl>


